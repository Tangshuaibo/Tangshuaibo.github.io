(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1306eb28"],{"159b":function(e,t,n){var o=n("da84"),r=n("fdbc"),a=n("17c2"),i=n("9112");for(var s in r){var c=o[s],u=c&&c.prototype;if(u&&u.forEach!==a)try{i(u,"forEach",a)}catch(l){u.forEach=a}}},"17c2":function(e,t,n){"use strict";var o=n("b727").forEach,r=n("a640"),a=n("ae40"),i=r("forEach"),s=a("forEach");e.exports=i&&s?[].forEach:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}},2241:function(e,t,n){"use strict";var o,r=n("c31d"),a=n("2b0e"),i=n("d282"),s=n("ea8e"),c=n("b1d2"),u=n("6605"),l=n("b650"),d=Object(i["a"])("dialog"),f=d[0],g=d[1],p=d[2],m=f({mixins:[Object(u["a"])()],props:{title:String,width:[Number,String],message:String,className:null,callback:Function,beforeClose:Function,messageAlign:String,cancelButtonText:String,cancelButtonColor:String,confirmButtonText:String,confirmButtonColor:String,showCancelButton:Boolean,transition:{type:String,default:"van-dialog-bounce"},showConfirmButton:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!1}},data:function(){return{loading:{confirm:!1,cancel:!1}}},methods:{onClickOverlay:function(){this.handleAction("overlay")},handleAction:function(e){var t=this;this.$emit(e),this.value&&(this.beforeClose?(this.loading[e]=!0,this.beforeClose(e,(function(n){!1!==n&&t.loading[e]&&t.onClose(e),t.loading.confirm=!1,t.loading.cancel=!1}))):this.onClose(e))},onClose:function(e){this.close(),this.callback&&this.callback(e)},onOpened:function(){this.$emit("opened")},onClosed:function(){this.$emit("closed")},genButtons:function(){var e,t=this,n=this.$createElement,o=this.showCancelButton&&this.showConfirmButton;return n("div",{class:[c["d"],g("footer",{buttons:o})]},[this.showCancelButton&&n(l["a"],{attrs:{size:"large",loading:this.loading.cancel,text:this.cancelButtonText||p("cancel")},class:g("cancel"),style:{color:this.cancelButtonColor},on:{click:function(){t.handleAction("cancel")}}}),this.showConfirmButton&&n(l["a"],{attrs:{size:"large",loading:this.loading.confirm,text:this.confirmButtonText||p("confirm")},class:[g("confirm"),(e={},e[c["b"]]=o,e)],style:{color:this.confirmButtonColor},on:{click:function(){t.handleAction("confirm")}}})])}},render:function(){var e,t=arguments[0];if(this.shouldRender){var n=this.message,o=this.messageAlign,r=this.slots(),a=this.slots("title")||this.title,i=a&&t("div",{class:g("header",{isolated:!n&&!r})},[a]),c=(r||n)&&t("div",{class:g("content")},[r||t("div",{domProps:{innerHTML:n},class:g("message",(e={"has-title":a},e[o]=o,e))})]);return t("transition",{attrs:{name:this.transition},on:{afterEnter:this.onOpened,afterLeave:this.onClosed}},[t("div",{directives:[{name:"show",value:this.value}],attrs:{role:"dialog","aria-labelledby":this.title||n},class:[g(),this.className],style:{width:Object(s["a"])(this.width)}},[i,c,this.genButtons()])])}}}),h=n("a142");function v(e){return document.body.contains(e)}function b(){o&&o.$destroy(),o=new(a["a"].extend(m))({el:document.createElement("div"),propsData:{lazyRender:!1}}),o.$on("input",(function(e){o.value=e}))}function w(e){return h["f"]?Promise.resolve():new Promise((function(t,n){o&&v(o.$el)||b(),Object(r["a"])(o,w.currentOptions,e,{resolve:t,reject:n})}))}w.defaultOptions={value:!0,title:"",width:"",message:"",overlay:!0,className:"",lockScroll:!0,transition:"van-dialog-bounce",beforeClose:null,overlayClass:"",overlayStyle:null,messageAlign:"",getContainer:"body",cancelButtonText:"",cancelButtonColor:null,confirmButtonText:"",confirmButtonColor:null,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!1,closeOnClickOverlay:!1,callback:function(e){o["confirm"===e?"resolve":"reject"](e)}},w.alert=w,w.confirm=function(e){return w(Object(r["a"])({showCancelButton:!0},e))},w.close=function(){o&&(o.value=!1)},w.setDefaultOptions=function(e){Object(r["a"])(w.currentOptions,e)},w.resetDefaultOptions=function(){w.currentOptions=Object(r["a"])({},w.defaultOptions)},w.resetDefaultOptions(),w.install=function(){a["a"].use(m)},w.Component=m,a["a"].prototype.$dialog=w;t["a"]=w},"2fcb":function(e,t,n){},"327e":function(e,t,n){},"3b63":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"page-settings"}},[o("NavBar",{attrs:{title:"设置",border:"",fixed:"",placeholder:"","left-arrow":""},on:{"click-left":e.jumpToPreviousPage}}),o("VanImage",{attrs:{id:"page-settings-main-icon",round:"",width:"100px",height:"100px",fit:"cover",src:n("db7c")}}),o("h3",{attrs:{id:"page-settings-main-nickname"}},[e._v(" "+e._s(e.appUserInfo.nickName)+" ")]),o("CellGroup",{attrs:{title:"基本信息"}},[o("Cell",{attrs:{title:"UID",value:e.appUserInfo.uid,center:""}}),o("Cell",{attrs:{title:"用户名",value:e.appUserInfo.userName,center:""}}),o("Cell",{attrs:{title:"注册时间",value:e.appUserInfo.createdAt,center:""}})],1),o("CellGroup",{attrs:{title:"信息修改"}},[o("Cell",{attrs:{title:"修改昵称","is-link":"",center:""},on:{click:e.togglePopupNickname}}),o("Cell",{attrs:{title:"修改密码","is-link":"",center:""},on:{click:e.togglePopupPassword}})],1),o("CellGroup",{attrs:{title:"数据同步"}},[o("Cell",{attrs:{title:"上传数据",value:"上传本地数据至云端","is-link":"",center:""},on:{click:e.uploadUserData}}),o("Cell",{attrs:{title:"下载数据",value:"下载云端数据至本地","is-link":"",center:""},on:{click:e.downloadUserData}})],1),o("div",{attrs:{id:"page-settings-main-btns"}},[o("Button",{attrs:{id:"page-settings-main-btn-unregistration",type:"danger",block:"",round:""},on:{click:e.deleteUserAccount}},[e._v(" 注销账号 ")]),o("Button",{attrs:{id:"page-settings-main-btn-logout",type:"warning",block:"",round:""},on:{click:e.requestToLogout}},[e._v(" 退出登录 ")])],1),o("PageSettingsNickname",{attrs:{show:e.showPopupNickname},on:{"update:show":function(t){e.showPopupNickname=t}}}),o("PageSettingsPassword",{attrs:{show:e.showPopupPassword},on:{"update:show":function(t){e.showPopupPassword=t}}})],1)},r=[],a=(n("99af"),n("4160"),n("d81d"),n("d3b7"),n("ac1f"),n("3ca3"),n("5319"),n("1276"),n("159b"),n("ddb0"),n("6b75"));function i(e){if(Array.isArray(e))return Object(a["a"])(e)}n("a4d3"),n("e01a"),n("d28b"),n("a630"),n("e260");function s(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}var c=n("06c5");function u(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e){return i(e)||s(e)||Object(c["a"])(e)||u()}n("e17f");var d=n("2241"),f=(n("96cf"),n("1da1")),g=(n("9a83"),n("f564")),p=(n("4056"),n("44bf")),m=(n("68ef"),n("9d70"),n("3743"),n("8a0b"),n("d282")),h=n("b1d2"),v=n("ad06"),b=Object(m["a"])("nav-bar"),w=b[0],k=b[1],P=w({props:{title:String,fixed:Boolean,zIndex:[Number,String],leftText:String,rightText:String,leftArrow:Boolean,placeholder:Boolean,border:{type:Boolean,default:!0}},data:function(){return{height:null}},mounted:function(){this.placeholder&&this.fixed&&(this.height=this.$refs.navBar.getBoundingClientRect().height)},methods:{genLeft:function(){var e=this.$createElement,t=this.slots("left");return t||[this.leftArrow&&e(v["a"],{class:k("arrow"),attrs:{name:"arrow-left"}}),this.leftText&&e("span",{class:k("text")},[this.leftText])]},genRight:function(){var e=this.$createElement,t=this.slots("right");return t||(this.rightText?e("span",{class:k("text")},[this.rightText]):void 0)},genNavBar:function(){var e,t=this.$createElement;return t("div",{ref:"navBar",style:{zIndex:this.zIndex},class:[k({fixed:this.fixed}),(e={},e[h["a"]]=this.border,e)]},[t("div",{class:k("left"),on:{click:this.onClickLeft}},[this.genLeft()]),t("div",{class:[k("title"),"van-ellipsis"]},[this.slots("title")||this.title]),t("div",{class:k("right"),on:{click:this.onClickRight}},[this.genRight()])])},onClickLeft:function(e){this.$emit("click-left",e)},onClickRight:function(e){this.$emit("click-right",e)}},render:function(){var e=arguments[0];return this.placeholder&&this.fixed?e("div",{class:k("placeholder"),style:{height:this.height+"px"}},[this.genNavBar()]):this.genNavBar()}}),y=(n("5c56"),n("2638")),C=n.n(y),O=n("ba31"),N=Object(m["a"])("cell-group"),B=N[0],j=N[1];function x(e,t,n,o){var r,a=e("div",C()([{class:[j(),(r={},r[h["e"]]=t.border,r)]},Object(O["b"])(o,!0)]),[null==n.default?void 0:n.default()]);return t.title||n.title?e("div",[e("div",{class:j("title")},[n.title?n.title():t.title]),a]):a}x.props={title:String,border:{type:Boolean,default:!0}};var U=B(x),$=(n("1a04"),n("7744")),S=(n("66b9"),n("b650")),E=n("3853"),F=n("3022"),L=n("a0d1"),I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Popup",{attrs:{id:"page-settings-password",position:"bottom",closeable:"","safe-area-inset-bottom":"","close-on-click-overlay":!1},on:{open:e.onPopupOpen,close:e.onPopupClose},model:{value:e.showPopup,callback:function(t){e.showPopup=t},expression:"showPopup"}},[n("div",{staticClass:"van-hairline--bottom",attrs:{id:"page-settings-password-title"}},[e._v(" 修改密码 ")]),n("Form",{ref:"pageSettingsPasswordFrom",attrs:{id:"page-settings-password-form","show-error":!1},on:{submit:e.doSubmitFormValues}},[n("Field",{ref:"fieldOldPassword",attrs:{name:"oldPassword",type:"password",label:"旧密码",placeholder:"请输入8至20个字符（字母或数字）",rules:e.rulesOldPassword},model:{value:e.formValues.oldPassword,callback:function(t){e.$set(e.formValues,"oldPassword",t)},expression:"formValues.oldPassword"}}),n("Field",{ref:"fieldNewPassword",attrs:{name:"newPassword",type:"password",label:"新密码",placeholder:"请输入8至20个字符（字母或数字）",rules:e.rulesNewPassword},model:{value:e.formValues.newPassword,callback:function(t){e.$set(e.formValues,"newPassword",t)},expression:"formValues.newPassword"}}),n("Field",{ref:"fieldConfirmation",attrs:{name:"confirmation",type:"password",label:"密码确认",placeholder:"请再次输入密码",rules:e.rulesConfirmation},model:{value:e.formValues.confirmation,callback:function(t){e.$set(e.formValues,"confirmation",t)},expression:"formValues.confirmation"}}),n("div",{attrs:{id:"page-settings-password-btns"}},[n("Button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[e._v(" 确认修改 ")])],1)],1)],1)},A=[],R=(n("caad"),n("2532"),n("8a58"),n("e41f")),D=(n("38d5"),n("772a")),V=(n("be7f"),n("565f")),T=n("9ab4"),q={name:"PageSettingsPassword",components:{Button:S["a"],Field:V["a"],Form:D["a"],Popup:R["a"]},props:{show:{type:Boolean,default:!1}},data:function(){return{patchingPassword:!1,urls:{getRSAPubKey:E["c"],patchPassword:E["j"]},formValues:{oldPassword:"",newPassword:"",confirmation:""},rulesOldPassword:[{required:!0,message:"请填写密码"},{message:"",validator:this.checkPasswordFormat}],rulesNewPassword:[{required:!0,message:"请填写密码"},{message:"",validator:this.checkPasswordFormat},{message:"新密码应与旧密码不同",validator:this.distinguishPassword}],rulesConfirmation:[{required:!0,message:"请再次填写新密码"},{message:"两次填写的新密码不一致",validator:this.confirmPassword}]}},computed:{showPopup:{get:function(){return this.show},set:function(e){this.$emit("update:show",e)}},isConnected:function(){return this.$store.getters.isConnected},isLoggedIn:function(){return this.$store.getters.isLoggedIn}},methods:{checkPasswordFormat:function(e,t){var n=/^[a-z0-9]+$/i,o=!1;return n.test(e)?e.length<8?t.message="字符不应少于8个":e.length>20?t.message="字符不应多于20个":o=!0:t.message="不应包含除字母和数字以外的字符",o},distinguishPassword:function(e){return this.formValues.oldPassword!==e},confirmPassword:function(e){return this.formValues.newPassword===e},onPopupOpen:function(){Object.assign(this.formValues,{oldPassword:"",newPassword:"",confirmation:""})},onPopupClose:function(){this.$refs.pageSettingsPasswordFrom.resetValidation()},notifyBadConnection:function(){Object(g["a"])({type:"danger",message:"连接服务器失败"})},getRSAPubKey:function(){return Object(L["d"])().get(this.urls.getRSAPubKey).then((function(e){return e.data.payload.key})).catch((function(e){return Promise.reject(e)}))},patchRSAEncryptedMsg:function(e,t){var n=this;return Object(L["c"])(e).patch(this.urls.patchPassword,t).then((function(e){return e})).catch((function(e){var t,o,r=null===e||void 0===e||null===(t=e.response)||void 0===t||null===(o=t.data)||void 0===o?void 0:o.message;return"crypto/bcrypt: hashedPassword is not the hash of the given password"===r&&(n.$refs.fieldOldPassword.validateMessage="输入的旧密码不正确"),(null===r||void 0===r?void 0:r.includes("RequestUserPasswordChange.newPassword"))&&(n.$refs.fieldNewPassword.validateMessage="请再次检查新密码"),Promise.reject(e)}))},submitFormValues:function(e){var t=this;return Object(f["a"])(regeneratorRuntime.mark((function n(){var o,r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.getRSAPubKey();case 2:return o=n.sent,r={oldPassword:Object(T["a"])(e.oldPassword),newPassword:Object(T["a"])(e.newPassword)},n.next=6,t.patchRSAEncryptedMsg(o,r);case 6:return a=n.sent,n.abrupt("return",a);case 8:case"end":return n.stop()}}),n)})))()},doSubmitFormValues:function(e){var t=this;this.patchingPassword||(this.patchingPassword=!0,this.isConnected?this.submitFormValues(e).then((function(e){Object(g["a"])({type:"success",message:"密码修改成功"}),t.showPopup=!1,Promise.allSettled([t.$store.dispatch("updateAppJWTString",void 0),t.$store.dispatch("updateAppUserInfo",void 0)]).then((function(){t.$router.replace("/login")}))})).catch((function(){t.isConnected&&t.isLoggedIn&&Object(g["a"])({type:"danger",message:"密码修改失败"})})).finally((function(){t.patchingPassword=!1})):this.notifyBadConnection())}}},_=q,G=(n("54d8"),n("2877")),M=Object(G["a"])(_,I,A,!1,null,"44a32f3b",null),z=M.exports,H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Popup",{attrs:{id:"page-settings-nickname",position:"bottom",closeable:"","safe-area-inset-bottom":"","close-on-click-overlay":!1},on:{open:e.onPopupOpen,close:e.onPopupClose},model:{value:e.showPopup,callback:function(t){e.showPopup=t},expression:"showPopup"}},[n("div",{staticClass:"van-hairline--bottom",attrs:{id:"page-settings-nickname-title"}},[e._v(" 修改昵称 ")]),n("Form",{ref:"pageSettingsNicknameForm",attrs:{id:"page-settings-nickname-form","show-error":!1},on:{submit:e.doSubmitFormValues}},[n("Field",{ref:"fieldOldNickname",attrs:{name:"oldNickname",label:"旧昵称",placeholder:"请输入1至30个字符（字母/数字/汉字）",rules:e.rulesOldNickname,disabled:""},model:{value:e.formValues.oldNickname,callback:function(t){e.$set(e.formValues,"oldNickname",t)},expression:"formValues.oldNickname"}}),n("Field",{ref:"fieldNewNickname",attrs:{name:"newNickname",label:"新昵称",placeholder:"请输入1至30个字符（字母/数字/汉字）",rules:e.rulesNewNickname},model:{value:e.formValues.newNickname,callback:function(t){e.$set(e.formValues,"newNickname",t)},expression:"formValues.newNickname"}}),n("div",{attrs:{id:"page-settings-nickname-btns"}},[n("Button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[e._v(" 确认修改 ")])],1)],1)],1)},J=[],K={name:"PageSettingsNickname",components:{Button:S["a"],Field:V["a"],Form:D["a"],Popup:R["a"]},props:{show:{type:Boolean,default:!1}},data:function(){return{patchingNickname:!1,urls:{patchNickname:E["i"]},formValues:{oldNickname:"",newNickname:""},rulesOldNickname:[{required:!0,message:"请填写旧昵称"},{message:"",validator:this.checkNicknameFormat}],rulesNewNickname:[{required:!0,message:"请填写新昵称"},{message:"",validator:this.checkNicknameFormat},{message:"新昵称应与旧昵称不同",validator:this.distinguishNickname}]}},computed:{showPopup:{get:function(){return this.show},set:function(e){this.$emit("update:show",e)}},isConnected:function(){return this.$store.getters.isConnected},isLoggedIn:function(){return this.$store.getters.isLoggedIn}},methods:{checkNicknameFormat:function(e,t){var n=/^[\u4e00-\u9fa5\w]+$/,o=!1;return n.test(e)?e.length<1?t.message="字符不应少于1个":e.length>30?t.message="字符不应多于30个":o=!0:t.message="只能使用：字母/数字/汉字",o},distinguishNickname:function(e){return this.formValues.oldNickname!==e},onPopupOpen:function(){Object.assign(this.formValues,{oldNickname:this.$store.state.appUserInfo.nickName,newNickname:""})},onPopupClose:function(){this.$refs.pageSettingsNicknameForm.resetValidation()},notifyBadConnection:function(){Object(g["a"])({type:"danger",message:"连接服务器失败"})},patchAESEncryptedMsg:function(e){var t=this;return Object(L["b"])().patch(this.urls.patchNickname,e).then((function(e){return e})).catch((function(e){var n,o,r=null===e||void 0===e||null===(n=e.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message;return"mismatched old nickname"===r&&(t.$refs.fieldOldNickname.validateMessage="旧昵称不匹配"),(null===r||void 0===r?void 0:r.includes("RequestUserNicknameChange.oldNickname"))&&(t.$refs.fieldOldNickname.validateMessage="请再次检查旧昵称"),(null===r||void 0===r?void 0:r.includes("RequestUserNicknameChange.newNickname"))&&(t.$refs.fieldNewNickname.validateMessage="请再次检查新昵称"),Promise.reject(e)}))},submitFormValues:function(e){var t=this;return Object(f["a"])(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={oldNickname:t.formValues.oldNickname,newNickname:t.formValues.newNickname},e.next=3,t.patchAESEncryptedMsg(n);case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})))()},doSubmitFormValues:function(e){var t=this;this.patchingNickname||(this.patchingNickname=!0,this.isConnected?this.submitFormValues(e).then((function(){Object(g["a"])({type:"success",message:"昵称修改成功"}),t.$store.dispatch("updateAppUserInfo",{nickName:t.formValues.newNickname}).then((function(){t.showPopup=!1}))})).catch((function(){t.isConnected&&t.isLoggedIn&&Object(g["a"])({type:"danger",message:"昵称修改失败"})})).finally((function(){t.patchingNickname=!1})):this.notifyBadConnection())}}},W=K,Y=(n("d809"),Object(G["a"])(W,H,J,!1,null,"a0e5af74",null)),Q=Y.exports,X={name:"PageSettings",components:{Button:S["a"],Cell:$["a"],CellGroup:U,NavBar:P,VanImage:p["a"],PageSettingsNickname:Q,PageSettingsPassword:z},data:function(){return{isDeletingUserAccount:!1,isLoggingOut:!1,isUploadingUserData:!1,isDownloadingUserData:!1,urls:{urlDeleteAccount:E["b"],urlGetUserLogout:E["g"],urlPostUserBookmark:E["m"],urlPostUserBackground:E["l"],urlGetUserBookmark:E["e"],urlGetUserBackground:E["d"]},showPopupPassword:!1,showPopupNickname:!1}},computed:{appUserInfo:function(){return this.$store.state.appUserInfo},isConnected:function(){return this.$store.getters.isConnected},isLoggedIn:function(){return this.$store.getters.isLoggedIn}},watch:{isConnected:function(e){e||this.notifyBadConnection()},isLoggedIn:function(e){e||(this.$router.replace("/login"),this.notifyLoginAgain())}},methods:{jumpToPreviousPage:function(){this.$router.back()},togglePopupNickname:function(){this.showPopupNickname=!0},togglePopupPassword:function(){this.showPopupPassword=!0},notifyBadConnection:function(){Object(g["a"])({type:"danger",message:"连接服务器失败"})},notifyLoginAgain:function(){Object(g["a"])({type:"warning",message:"请重新登录"})},notifyRequestFrequencyHigh:function(){Object(g["a"])({type:"warning",message:"请求过于频繁，请稍后重试"})},clearLocalDate:function(){this.$store.dispatch("updateAppJWTString",void 0),this.$store.dispatch("updateAppUserInfo",void 0)},deleteUserAccount:function(){var e=this;return Object(f["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isDeletingUserAccount){t.next=2;break}return t.abrupt("return");case 2:return e.isDeletingUserAccount=!0,t.next=5,d["a"].confirm({title:"警告",message:"请再次确认是否注销账户"}).then((function(){return!0})).catch((function(){return!1}));case 5:if(n=t.sent,n){t.next=8;break}return t.abrupt("return");case 8:if(e.isConnected){t.next=11;break}return e.notifyBadConnection(),t.abrupt("return");case 11:Object(L["a"])().delete(e.urls.urlDeleteAccount).then((function(){Object(g["a"])({type:"success",message:"注销成功"}),e.clearLocalDate(),e.$router.replace("/")})).catch((function(){e.isConnected&&e.isLoggedIn&&Object(g["a"])({type:"danger",message:"账号注销失败"})})).finally((function(){e.isDeletingUserAccount=!1}));case 12:case"end":return t.stop()}}),t)})))()},requestToLogout:function(){var e=this;this.isLoggingOut||(this.isLoggingOut=!0,this.isConnected?Object(L["a"])().get(this.urls.urlGetUserLogout).then((function(){Object(g["a"])({type:"success",message:"退出登录成功"}),e.clearLocalDate(),e.$router.replace("/")})).catch((function(){e.isConnected&&e.isLoggedIn&&Object(g["a"])({type:"danger",message:"退出登录失败"})})).finally((function(){e.isLoggingOut=!1})):this.notifyBadConnection())},postUserBookmarks:function(){var e=this,t=this.$store.state.appAESSecrets,n=this.$store.state.appUserBookmarks,o=new FormData,r=n.map((function(e){return{title:null===e||void 0===e?void 0:e.title,url:null===e||void 0===e?void 0:e.url,iconName:e.iconName}})),a=Object(F["b"])(t.iv,t.key,r),i=n.map((function(e){return e.iconFile}));return o.append("detail",a),i.forEach((function(e){o.append("icon",e)})),new Promise((function(t,n){return Object(L["d"])().post(e.urls.urlPostUserBookmark,o).then((function(){Object(g["a"])({type:"success",duration:2e3,message:"书签信息上传成功",onClose:function(){return t()}})})).catch((function(o){return e.isConnected?e.isLoggedIn?(console.error(o),void Object(g["a"])({type:"danger",duration:2e3,message:"书签信息上传失败",onClose:function(){return t()}})):n(new Error("user is not logged in")):n(new Error("server disconnected"))}))}))},postUserBackground:function(){var e=this,t=this.$store.state.appAESSecrets,n=this.$store.state.appUserBackground,o=new FormData,r={titleColor:n.bmTitleColor,imageName:n.bgImgName},a=Object(F["b"])(t.iv,t.key,r);return o.append("detail",a),(null===n||void 0===n?void 0:n.bgImgFile)&&o.append("image",n.bgImgFile),new Promise((function(t,n){return Object(L["d"])().post(e.urls.urlPostUserBackground,o).then((function(){Object(g["a"])({type:"success",duration:2e3,message:"背景信息上传成功",onClose:function(){return t()}})})).catch((function(o){return e.isConnected?e.isLoggedIn?(console.error(o),void Object(g["a"])({type:"danger",duration:2e3,message:"背景信息上传失败",onClose:function(){return t()}})):n(new Error("user is not logged in")):n(new Error("server disconnected"))}))}))},downloadUserBookmarks:function(){var e=this;return Object(f["a"])(regeneratorRuntime.mark((function t(){var n,o,r,a,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=[],o=[],t.next=4,new Promise((function(t,n){return Object(L["a"])().get(e.urls.urlGetUserBookmark).then((function(e){var n;return t(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.payload)})).catch((function(t){return e.isConnected?e.isLoggedIn?(console.error(t),void Object(g["a"])({type:"danger",duration:2e3,message:"书签信息下载失败",onClose:function(){return n(t)}})):n(new Error("user is not logged in")):n(new Error("server disconnected"))}))}));case 4:r=t.sent,n.push.apply(n,l(r)),a=regeneratorRuntime.mark((function e(){var t,n,r,a,c,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=s[i],a="".concat(E["a"]).concat(null===r||void 0===r?void 0:r.iconPath),c=null===r||void 0===r||null===(t=r.iconPath)||void 0===t?void 0:t.split("/").pop(),u="image/".concat(null===r||void 0===r||null===(n=r.iconPath)||void 0===n?void 0:n.split(".").pop()),l={title:null===r||void 0===r?void 0:r.title,url:null===r||void 0===r?void 0:r.url,iconName:c,iconSrc:void 0,iconFile:void 0},e.next=7,Object(L["d"])().get(a,{responseType:"blob"}).then((function(e){return new Promise((function(t,n){var o=null===e||void 0===e?void 0:e.data;if(!(null===o||void 0===o?void 0:o.size))return n(new Error("invalid icon file ".concat(c)));var r=new FileReader;r.addEventListener("load",(function(){return l.iconSrc=r.result,l.iconFile=new File([o],c,{type:u}),t()})),r.addEventListener("error",(function(){return n(new Error("failed to convert icon file ".concat(c)))})),r.addEventListener("abort",(function(){return n(new Error("icon file ".concat(c," conversion aborted")))})),r.readAsDataURL(o)})).catch((function(e){console.error(e)})).finally((function(){o.push(l)}))})).catch((function(){console.log("failed to access image from ".concat(a)),o.push(l)}));case 7:case"end":return e.stop()}}),e)})),i=0,s=n;case 8:if(!(i<s.length)){t.next=13;break}return t.delegateYield(a(),"t0",10);case 10:i++,t.next=8;break;case 13:return t.abrupt("return",new Promise((function(t,n){return e.$store.dispatch("saveAppUserBookmarks",o).then((function(){Object(g["a"])({type:"success",duration:2e3,message:"书签信息更新完成",onClose:function(){return t()}})})).catch((function(e){Object(g["a"])({type:"danger",duration:2e3,message:"书签信息更新失败",onClose:function(){return n(e)}})}))})));case 14:case"end":return t.stop()}}),t)})))()},downloadUserBackground:function(){var e=this;return Object(f["a"])(regeneratorRuntime.mark((function t(){var n,o,r,a,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,n){return Object(L["a"])().get(e.urls.urlGetUserBackground).then((function(e){var n;return t(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.payload)})).catch((function(t){return e.isConnected?e.isLoggedIn?void Object(g["a"])({type:"danger",duration:2e3,message:"背景信息下载失败",onClose:function(){return n(t)}}):n(new Error("user is not logged in")):n(new Error("server disconnected"))}))}));case 2:return n=t.sent,o="".concat(E["a"]).concat(null===n||void 0===n?void 0:n.imagePath),r=null===n||void 0===n?void 0:n.imagePath.split("/").pop(),a="image/".concat(null===n||void 0===n?void 0:n.imagePath.split(".").pop()),t.next=8,new Promise((function(t,n){return Object(L["d"])().get(o,{responseType:"blob"}).then((function(e){var o=null===e||void 0===e?void 0:e.data;if(!(null===o||void 0===o?void 0:o.size))return n(new Error("invalid image file ".concat(r)));var i=new FileReader;i.addEventListener("load",(function(){var e={bgImgDataURL:i.result,bgImgFile:new File([o],r,{type:a})};return t(e)})),i.addEventListener("error",(function(){return n(new Error("failed to convert image file ".concat(r)))})),i.addEventListener("abort",(function(){return n(new Error("image file ".concat(r," conversion aborted")))})),i.readAsDataURL(o)})).catch((function(){return e.isConnected?e.isLoggedIn?(console.log("failed to access image from ".concat(o)),void Object(g["a"])({type:"danger",duration:2e3,message:"背景信息下载失败",onClose:function(){return t({bgImgDataURL:void 0,bgImgFile:void 0})}})):n(new Error("user is not logged in")):n(new Error("server disconnected"))}))})).catch((function(e){console.error(e)}));case 8:return i=t.sent,s={bmTitleColor:null===n||void 0===n?void 0:n.titleColor,bgImgName:r,bgImgFile:null===i||void 0===i?void 0:i.bgImgFile,bgImgDataURL:null===i||void 0===i?void 0:i.bgImgDataURL},t.abrupt("return",new Promise((function(t,n){return e.$store.dispatch("saveAppUserBackground",s).then((function(){Object(g["a"])({type:"success",duration:2e3,message:"背景信息更新完成",onClose:function(){return t()}})})).catch((function(e){Object(g["a"])({type:"danger",duration:2e3,message:"背景信息更新失败",onClose:function(){return n(e)}})}))})));case 11:case"end":return t.stop()}}),t)})))()},uploadUserData:function(){var e=this;return Object(f["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isUploadingUserData){t.next=3;break}return e.notifyRequestFrequencyHigh(),t.abrupt("return");case 3:return e.isUploadingUserData=!0,t.prev=4,t.next=7,e.postUserBookmarks();case 7:return t.next=9,e.postUserBackground();case 9:return t.prev=9,setTimeout((function(){e.isUploadingUserData=!1}),1e4),t.finish(9);case 12:case"end":return t.stop()}}),t,null,[[4,,9,12]])})))()},downloadUserData:function(){var e=this;return Object(f["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isDownloadingUserData){t.next=3;break}return e.notifyRequestFrequencyHigh(),t.abrupt("return");case 3:return e.isDownloadingUserData=!0,t.prev=4,t.next=7,e.downloadUserBookmarks();case 7:return t.next=9,e.downloadUserBackground();case 9:return t.prev=9,setTimeout((function(){e.isDownloadingUserData=!1}),1e4),t.finish(9);case 12:case"end":return t.stop()}}),t,null,[[4,,9,12]])})))()}}},Z=X,ee=(n("d092"),Object(G["a"])(Z,o,r,!1,null,"29e6b9dd",null));t["default"]=ee.exports},4160:function(e,t,n){"use strict";var o=n("23e7"),r=n("17c2");o({target:"Array",proto:!0,forced:[].forEach!=r},{forEach:r})},4797:function(e,t,n){},"54d8":function(e,t,n){"use strict";var o=n("4797"),r=n.n(o);r.a},"5c56":function(e,t,n){},"8a0b":function(e,t,n){},"8a58":function(e,t,n){"use strict";n("68ef"),n("a71a"),n("9d70"),n("3743"),n("4d75")},"9ab4":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n("3452"),r=n.n(o);function a(e){"string"!==typeof e&&(e=JSON.stringify(e));var t=r.a.SHA256(e),n=r.a.enc.Base64.stringify(t);return n}},a640:function(e,t,n){"use strict";var o=n("d039");e.exports=function(e,t){var n=[][e];return!!n&&o((function(){n.call(null,t||function(){throw 1},1)}))}},a8eb:function(e,t,n){},d092:function(e,t,n){"use strict";var o=n("327e"),r=n.n(o);r.a},d809:function(e,t,n){"use strict";var o=n("a8eb"),r=n.n(o);r.a},db7c:function(e,t,n){e.exports=n.p+"img/default_avatar.db6e1d54.png"},e17f:function(e,t,n){"use strict";n("68ef"),n("a71a"),n("9d70"),n("3743"),n("4d75"),n("e3b3"),n("bc1b"),n("2fcb")}}]);
//# sourceMappingURL=chunk-1306eb28.58e6071d.js.map